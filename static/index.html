<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seora's Recipe Saver ‚ù§Ô∏è</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üç≥</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%233d2c1e%22/><text y=%22.85em%22 x=%2250%25%22 text-anchor=%22middle%22 font-size=%2270%22>üç≥</text></svg>">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Seora's Recipes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#3d2c1e">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --cream: #faf7f2;
      --brown: #3d2c1e;
      --orange: #e8682a;
      --light: #f0ebe3;
      --border: #ddd5c8;
      --blue: #3b82f6;
    }
    body { background: var(--cream); font-family: 'Pretendard', sans-serif; color: var(--brown); min-height: 100vh; }
    header { background: var(--brown); color: var(--cream); padding: 24px 40px; display: flex; align-items: center; justify-content: center; gap: 12px; }
    header h1 { font-family: 'Pretendard', sans-serif; font-weight: 700; font-size: 28px; }
    header .subtitle { font-size: 13px; opacity: 0.6; margin-left: auto; }
    .container { max-width: 700px; margin: 48px auto; padding: 0 24px; }

    .tabs { display: flex; margin-bottom: 24px; border-radius: 12px; overflow: hidden; border: 2px solid var(--border); }
    .tab { flex: 1; padding: 14px; text-align: center; cursor: pointer; font-size: 15px; font-weight: 500; background: white; border: none; font-family: 'Pretendard', sans-serif; color: #888; transition: all 0.2s; }
    .tab.active { background: var(--brown); color: white; }
    .tab:hover:not(.active) { background: var(--light); }

    .card { background: white; border-radius: 16px; padding: 40px 32px; text-align: center; }
    .card.dashed { border: 2px dashed var(--border); cursor: pointer; transition: all 0.2s; }
    .card.dashed:hover { border-color: var(--orange); background: #fff8f5; }
    .card.solid { border: 2px solid var(--border); text-align: left; }
    .upload-icon { font-size: 56px; margin-bottom: 16px; }
    .card h2 { font-family: 'Pretendard', sans-serif; font-weight: 700; font-size: 22px; margin-bottom: 8px; }
    .card p { color: #888; font-size: 14px; margin-bottom: 24px; line-height: 1.6; }

    .btn { background: var(--orange); color: white; border: none; padding: 14px 32px; border-radius: 50px; font-size: 16px; font-family: 'Pretendard', sans-serif; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; }
    .btn:hover { background: #d45a20; transform: translateY(-1px); }
    .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
    .btn.blue { background: var(--blue); }
    .btn.blue:hover { background: #2563eb; }
    .extract-btn { margin-top: 24px; width: 100%; justify-content: center; padding: 16px; font-size: 17px; border-radius: 12px; }

    .previews { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 16px; justify-content: center; }
    .preview-img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 2px solid var(--border); }

    textarea { width: 100%; height: 220px; padding: 16px; border: 2px solid var(--border); border-radius: 12px; font-size: 14px; font-family: 'Pretendard', sans-serif; resize: vertical; outline: none; line-height: 1.6; transition: border 0.2s; }
    textarea:focus { border-color: var(--blue); }
    textarea::placeholder { color: #bbb; }

    .status { margin-top: 20px; padding: 16px 20px; border-radius: 12px; font-size: 15px; display: none; }
    .status.loading { background: #fff8f0; border: 1px solid #ffd5b0; color: var(--brown); display: flex; align-items: center; gap: 10px; }
    .status.success { background: #f0fff4; border: 1px solid #86efac; color: #166534; }
    .status.error { background: #fff0f0; border: 1px solid #fca5a5; color: #991b1b; }
    .spinner { width: 20px; height: 20px; border: 2px solid #ffd5b0; border-top-color: var(--orange); border-radius: 50%; animation: spin 0.8s linear infinite; flex-shrink: 0; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .recipe-result { margin-top: 32px; background: white; border-radius: 16px; padding: 32px; border: 1px solid var(--border); display: none; }
    .recipe-result.show { display: block; }
    .recipe-result h2 { font-family: 'Pretendard', sans-serif; font-weight: 700; font-size: 26px; margin-bottom: 8px; }
    .meta { display: flex; gap: 10px; margin-bottom: 24px; flex-wrap: wrap; }
    .meta-tag { background: var(--light); padding: 6px 14px; border-radius: 50px; font-size: 13px; color: #666; }
    .section-title { font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--orange); margin-bottom: 10px; margin-top: 20px; }
    .ingredients-list { list-style: none; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .ingredients-list li { display: flex; align-items: center; gap: 8px; font-size: 14px; }
    .ingredients-list li::before { content: '‚òê'; color: var(--orange); font-size: 16px; flex-shrink: 0; }
    .steps-list { list-style: none; display: flex; flex-direction: column; gap: 10px; }
    .steps-list li { display: flex; gap: 12px; font-size: 14px; line-height: 1.6; align-items: flex-start; }
    .step-num { background: var(--orange); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; flex-shrink: 0; margin-top: 2px; }
    .notion-link { margin-top: 20px; text-align: center; font-size: 14px; color: #888; }
    .notion-link strong { color: #166534; }
    .source-link-wrap { margin-top: 16px; }
    .source-link-wrap label { font-size: 13px; color: #888; display: block; margin-bottom: 6px; }
    .source-input { width: 100%; padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-size: 14px; font-family: "DM Sans", sans-serif; outline: none; transition: border 0.2s; }
    .source-input:focus { border-color: var(--orange); }
    @media (max-width: 500px) { .ingredients-list { grid-template-columns: 1fr; } header { padding: 16px 20px; } .container { margin: 24px auto; } }
  </style>
</head>
<body>

<header>
  <span>üç≥</span>
  <h1>Seora's Recipe Saver ‚ù§Ô∏è</h1>
  
</header>

<div class="container">

  <div class="tabs">
    <button class="tab active" onclick="switchTab('image', this)">üì∏ Upload Screenshot</button>
    <button class="tab" onclick="switchTab('text', this)">üìù Paste Text</button>
  </div>

  <!-- Image Panel -->
  <div id="imagePanel">
    <div class="card dashed" id="dropZone"
      ondragover="event.preventDefault(); this.style.borderColor='#e8682a'"
      ondragleave="this.style.borderColor=''"
      ondrop="handleDrop(event)">
      <div class="upload-icon">üì∏</div>
      <h2>Upload Recipe Screenshots</h2>
      <p>Take screenshots from Instagram Reels or any recipe source.<br>Multiple images supported!</p>
      <button class="btn" onclick="document.getElementById('fileInput').click()">Choose Images</button>
      <input type="file" id="fileInput" accept="image/*" multiple style="display:none" onchange="handleFiles(this.files)"/>
      <div class="previews" id="previews"></div>
    </div>
    <div class="source-link-wrap">
      <label>üîó Source link (optional) ‚Äî paste Instagram, YouTube or any URL</label>
      <input type="text" class="source-input" id="sourceLinkImage" placeholder="https://www.instagram.com/reel/..."/>
    </div>
    <button class="btn extract-btn" id="extractBtnImage" disabled onclick="extractRecipe('image')">‚ú® Extract & Save to Notion</button>
  </div>

  <!-- Text Panel -->
  <div id="textPanel" style="display:none;">
    <div class="card solid">
      <div style="font-size:40px;margin-bottom:12px;">üìù</div>
      <h2 style="text-align:center;">Paste Recipe Text</h2>
      <p style="text-align:center;">Copy and paste any recipe text ‚Äî from a website, blog, message, or anywhere else</p>
      <textarea id="recipeTextInput" placeholder="Paste your recipe here...&#10;&#10;Example:&#10;Salmon Bowl&#10;Ingredients: 1 salmon fillet, 125g lentils...&#10;Steps: 1. Roast salmon at 200¬∞C..." oninput="checkText()"></textarea>
    </div>
    <div class="source-link-wrap">
      <label>üîó Source link (optional) ‚Äî paste Instagram, YouTube or any URL</label>
      <input type="text" class="source-input" id="sourceLinkText" placeholder="https://www.instagram.com/reel/..."/>
    </div>
    <button class="btn extract-btn blue" id="extractBtnText" disabled onclick="extractRecipe('text')">üìù Extract & Save to Notion</button>
  </div>

  <div class="status loading" id="statusLoading" style="display:none;">
    <div class="spinner"></div>
    <span id="loadingText">Reading your recipe with AI... this takes about 10 seconds</span>
  </div>
  <div class="status success" id="statusSuccess" style="display:none;"></div>
  <div class="status error" id="statusError" style="display:none;"></div>

  <div class="recipe-result" id="recipeResult">
    <h2 id="recipeTitle"></h2>
    <div class="meta">
      <span class="meta-tag" id="cookTime"></span>
      <span class="meta-tag" id="servings"></span>
    </div>
    <div class="section-title">Ingredients</div>
    <ul class="ingredients-list" id="ingredientsList"></ul>
    <div class="section-title">Steps</div>
    <ul class="steps-list" id="stepsList"></ul>
    <div class="notion-link" id="notionLink">‚úÖ <strong>Saved to Notion!</strong> Check your Recipe page.</div>
  </div>

</div>

<script>
  let selectedFiles = [];

  function switchTab(tab, el) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('imagePanel').style.display = tab === 'image' ? 'block' : 'none';
    document.getElementById('textPanel').style.display = tab === 'text' ? 'block' : 'none';
    resetStatus();
  }

  function resetStatus() {
    document.getElementById('statusLoading').style.display = 'none';
    document.getElementById('statusSuccess').style.display = 'none';
    document.getElementById('statusError').style.display = 'none';
    document.getElementById('recipeResult').classList.remove('show');
  }

  const fileInput = document.getElementById('fileInput');
  const dropZone = document.getElementById('dropZone');
  dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = '#e8682a'; });
  dropZone.addEventListener('dragleave', () => dropZone.style.borderColor = '');
  dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.style.borderColor = ''; handleFiles(e.dataTransfer.files); });
  fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

  function handleFiles(files) {
    selectedFiles = Array.from(files);
    const previews = document.getElementById('previews');
    previews.innerHTML = '';
    selectedFiles.forEach(file => {
      const img = document.createElement('img');
      img.className = 'preview-img';
      img.src = URL.createObjectURL(file);
      previews.appendChild(img);
    });
    document.getElementById('extractBtnImage').disabled = selectedFiles.length === 0;
  }

  function handleDrop(e) {
    e.preventDefault();
    handleFiles(e.dataTransfer.files);
  }

  function checkText() {
    const val = document.getElementById('recipeTextInput').value.trim();
    document.getElementById('extractBtnText').disabled = val.length < 10;
  }

  async function extractRecipe(mode) {
    resetStatus();
    document.getElementById('statusLoading').style.display = 'flex';
    const formData = new FormData();

    const sourceLink = mode === 'text'
      ? document.getElementById('sourceLinkText').value.trim()
      : document.getElementById('sourceLinkImage').value.trim();
    if (sourceLink) formData.append('source_link', sourceLink);

    if (mode === 'text') {
      const text = document.getElementById('recipeTextInput').value.trim();
      formData.append('recipe_text', text);
      document.getElementById('loadingText').textContent = 'Structuring your recipe with AI...';
      document.getElementById('extractBtnText').disabled = true;
    } else {
      selectedFiles.forEach(file => formData.append('images', file));
      document.getElementById('loadingText').textContent = 'Reading your recipe with AI... this takes about 10 seconds';
      document.getElementById('extractBtnImage').disabled = true;
    }

    try {
      const res = await fetch('/extract', { method: 'POST', body: formData });
      const data = await res.json();
      document.getElementById('statusLoading').style.display = 'none';

      if (!res.ok || data.error) {
        document.getElementById('statusError').textContent = '‚ùå ' + (data.error || 'Something went wrong');
        document.getElementById('statusError').style.display = 'block';
      } else {
        const successEl = document.getElementById('statusSuccess');
        if (data.isImaginary) {
          successEl.textContent = 'ü§ñ No written recipe found ‚Äî AI imagined a recipe from your photo and saved it to Notion!';
        } else if (data.source === 'text') {
          successEl.textContent = 'üìù Recipe extracted from your text and saved to Notion!';
        } else {
          successEl.textContent = '‚úÖ Recipe saved to your Notion page!';
        }
        successEl.style.display = 'block';
        showRecipe(data.recipe);
        if (data.notion_url) updateNotionLink(data.notion_url);
      }
    } catch (err) {
      document.getElementById('statusLoading').style.display = 'none';
      document.getElementById('statusError').textContent = '‚ùå Network error. Please try again.';
      document.getElementById('statusError').style.display = 'block';
    }

    document.getElementById('extractBtnImage').disabled = false;
    document.getElementById('extractBtnText').disabled = false;
  }

  function updateNotionLink(url) {
    const el = document.getElementById('notionLink');
    if (url) {
      // Convert https://notion.so/... to notion:// to open the Notion app directly
      const appUrl = url.replace('https://www.notion.so/', 'notion://www.notion.so/').replace('https://notion.so/', 'notion://notion.so/');
      el.innerHTML = '‚úÖ <strong>Saved to Notion!</strong> <a href="' + appUrl + '" style="color:#5c3d1e;font-weight:600;text-decoration:underline;">‚Üí Open in Notion</a>';
    }
  }

  function showRecipe(recipe) {
    document.getElementById('recipeTitle').textContent = recipe.title || 'Untitled Recipe';
    document.getElementById('cookTime').textContent = '‚è± ' + (recipe.cookTime || 'N/A');
    document.getElementById('servings').textContent = 'üë• ' + (recipe.servings || 'N/A');
    const ingList = document.getElementById('ingredientsList');
    ingList.innerHTML = '';
    (recipe.ingredients || []).forEach(ing => {
      const li = document.createElement('li');
      li.textContent = ing;
      ingList.appendChild(li);
    });
    const stepsList = document.getElementById('stepsList');
    stepsList.innerHTML = '';
    (recipe.steps || []).forEach((step, i) => {
      const li = document.createElement('li');
      li.innerHTML = `<span class="step-num">${i+1}</span><span>${step}</span>`;
      stepsList.appendChild(li);
    });
    document.getElementById('recipeResult').classList.add('show');
  }
</script>
</body>
</html>
